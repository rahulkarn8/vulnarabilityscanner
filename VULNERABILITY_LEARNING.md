# Vulnerability Learning System

The application now includes an automatic learning system that discovers and learns new vulnerability patterns as they are found during code scans.

## How It Works

### Automatic Learning

1. **During Scans**: When vulnerabilities are detected during code analysis, the system automatically:
   - Extracts patterns from discovered vulnerabilities
   - Stores them in the database
   - Uses them in future scans

2. **Pattern Extraction**: The system intelligently extracts regex patterns from matched code snippets, making them reusable for detecting similar vulnerabilities.

3. **Database Storage**: Learned patterns are stored in the `learned_vulnerabilities` table with:
   - Pattern name and regex
   - Language (Python or C++)
   - Severity level
   - Description
   - Discovery count (how many times found)
   - Code snippet example

### Manual Pattern Addition

You can also manually add custom vulnerability patterns via the API:

**Endpoint**: `POST /vulnerabilities/learn`

**Request Body**:
```json
{
  "name": "Custom Vulnerability Name",
  "pattern": "regex_pattern_here",
  "language": "python",
  "severity": "high",
  "description": "Description of the vulnerability"
}
```

**Example**:
```bash
curl -X POST http://localhost:8000/vulnerabilities/learn \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Unsafe Deserialization",
    "pattern": "yaml\\.load\\s*\\(",
    "language": "python",
    "severity": "high",
    "description": "Unsafe YAML deserialization can lead to code execution"
  }'
```

### Viewing Learned Patterns

**Endpoint**: `GET /vulnerabilities/learned`

**Query Parameters**:
- `language` (optional): Filter by language (`python` or `cpp`)

**Example**:
```bash
# Get all learned patterns
curl http://localhost:8000/vulnerabilities/learned

# Get only Python patterns
curl http://localhost:8000/vulnerabilities/learned?language=python
```

## Benefits

1. **Continuous Improvement**: The system gets better over time as it discovers new vulnerability patterns
2. **Custom Patterns**: Add organization-specific or domain-specific vulnerability patterns
3. **Pattern Reuse**: Once learned, patterns are automatically used in all future scans
4. **Tracking**: See how many times each pattern has been discovered

## Database Schema

The `learned_vulnerabilities` table stores:
- `id`: Unique identifier
- `name`: Vulnerability name
- `pattern`: Regex pattern for detection
- `language`: Programming language
- `severity`: Severity level
- `description`: Human-readable description
- `code_snippet`: Example code that triggered this pattern
- `discovered_count`: Number of times this pattern was found
- `is_active`: Whether the pattern is currently active
- `created_at`: When the pattern was first learned
- `updated_at`: Last time the pattern was found

## Notes

- Patterns are automatically loaded when the detector is initialized
- Duplicate patterns (same regex and language) are not created; instead, the discovery count is incremented
- Patterns can be disabled by setting `is_active = 0` in the database
- The learning system works alongside existing static patterns

